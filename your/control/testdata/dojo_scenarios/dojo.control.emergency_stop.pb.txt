name: "dojo.control.emergency_stop"
edit_attr {
  description: "Control dojo scenario: emergency stop"
  test_sets: "dojo"
  test_sets: "control_virtual_coverage"
}
execution {
  sim_duration: 30
  playback_sources { run_or_stf_path: "" }
  sim_modules {
    perception_module { module: PERCEPTION_MODULE playback_source_id: 0 }
    positioning_module { module: POSITIONING_MODULE playback_source_id: 0 }
    vehicle_control_module { module: VEHICLE_CONTROL_MODULE enable: true }
    spin_publisher_module { module: SPIN_PUBLISHER_MODULE disable: true }
    gnss_imu_driver_module {
      module: GNSS_IMU_DRIVER_MODULE
      playback_source_id: 0
    }
    image_publisher_module { module: IMAGE_PUBLISHER_MODULE disable: true }
    vantage_forwarding_module { module: VANTAGE_FORWARDING_MODULE enable: true }
    simulation_vehicle_module {
      module: SIMULATION_VEHICLE_MODULE
      enable: true
      module_conf {
        [qcraft.SimVehicleConf.sim_vehicle_conf] {
          engage_start_time: 1
          initial_pose {
            pos_smooth { x: 6.64 y: 80.5 }
            vel_body { x: 2 y: 0 }
            accel_body { x: 0 y: 0 }
            yaw: 3.141593
          }
        }
      }
    }
    can_bus_module { module: CAN_BUS_MODULE disable: true }
    autonomy_state_module { module: AUTONOMY_STATE_MODULE enable: true }
    planner_module { module: PLANNER_MODULE enable: true }
    virtual_object_module {
      module: VIRTUAL_OBJECT_MODULE
      enable: true
      module_conf {
        [qcraft.VirtualObjectsConfProto.virtual_objects_conf] {
          objects {
            virtual_perception_object {
              id: "Phantom 1"
              type: OT_VEHICLE
              length: 4.5
              width: 2
              parked: false
            }
            fixed_route_virtual_object {
              waypoints {
                pos { x: -23 y: 66 }
                t: 6
                v: 0
                z: 0
              }
              waypoints {
                pos { x: -23.12 y: 65.78 }
                t: 60
                v: 0
                z: 0
              }
            }
            start_sec: 6
          }
        }
      }
    }
    online_simulation_module { module: ONLINE_SIMULATION_MODULE disable: true }
    create_sim_messages_module {
      module: CREATE_SIM_MESSAGES_MODULE
      disable: true
    }
    remote_assist_module { module: REMOTE_ASSIST_MODULE enable: true }
    vision_module { module: VISION_MODULE playback_source_id: 0 }
    routing_module { module: ROUTING_MODULE enable: true }
    mock_localization_module { module: MOCK_LOCALIZATION_MODULE enable: true }
  }
}
metrics {
  name: "enter_cruise_metric"
  enter_cruise_metric {}
}
metrics {
  name: "execution_issue_metric"
  execution_issue_metric {}
}
metrics {
  name: "collision_metric"
  collision_metric {}
}
metrics {
  name: "stats_metric"
  stats_metric {}
}
metrics {
  name: "control_performance_metric"
  control_performance_metric {
    weighted_rms_error_metric: 0.2
    longitudinal_metric { error_max: 2.5 error_rms: 1.0 }
    speed_metric { error_max: 2.5 error_rms: 0.5 }
    stop_distance_max_threshold: 2.0
  }
}
commandline_flags: "--map=dojo"
commandline_flags: "--route_str=6b_s3"
commandline_flags: "--remote_control_server_address=127.0.0.1"
commandline_flags: "--simulation_vehicle_engine_publish_imu=true"
